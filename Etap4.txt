#Подключаемся к резервной базе
psql -h localhost -p 9426 -U new_role -d lazywhitewood
#Сотрим исходные данные в таблицах
\dt
select * from test_table_lw;
#Добавляем 3 строки в каждую таблицу:
INSERT INTO test_table_lw (name, value) VALUES
  ('A', 40),
  ('B', 50),
  ('C', 60);
#Проверяем добавленные строки:
select * from test_table_lw;
#Делаем дамп базы на резервном узле:
mkdir -p /var/db/postgres4/save_dump
# Имя дампа с датой
BACKUP_NAME="lazywhitewood_$(date +%F_%H-%M-%S)"
export BACKUP_NAME
pg_dump -h localhost -p 9426 -U new_role -d lazywhitewood -Fc -f /var/db/postgres4/save_dump/$BACKUP_NAME.dump
# На основном сервере (pg121) копируем дамп с резервного сервера (pg111)
# Получаем имя последнего дампа с резервного сервера (pg111)
BACKUP_NAME=$(ssh postgres4@pg111 "ls -1t /var/db/postgres4/save_dump/*.dump | head -n1 | xargs -n1 basename")
rsync -avz postgres4@pg111:/var/db/postgres4/save_dump/$BACKUP_NAME /var/db/postgres2/save_dump/
#Подключаемся к основной базе (где «сломаем» данные):
psql -p 9426 -U postgres2 -d lazywhitewood
#Пример «логической ошибки» — перезаписываем строки
UPDATE test_table_lw SET value = 0 WHERE name IN ('Z','Y','X');
select * from test_table_lw;
#Восстанавливаем данные из дампа
pg_restore -p 9426 -U postgres2 -d lazywhitewood -c -v /var/db/postgres2/save_dump/$BACKUP_NAME
#Подключаемся к базе для проверки
psql -h localhost -p 9426 -U new_role -d lazywhitewood
select * from test_table_lw;



